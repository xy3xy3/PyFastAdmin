{% extends "base.html" %}

{% block content %}
<div class="mx-auto max-w-6xl space-y-6 px-4 pb-16 pt-10 md:px-8">
  <section
    class="card p-6"
    x-data='{{ {"search_q": filters.search_q, "search_role": filters.search_role, "search_status": filters.search_status, "search_sort": filters.search_sort, "page": pagination.page}|tojson }}'
  >
    <div class="flex flex-wrap items-start justify-between gap-3">
      <div>
        <h1 class="font-display text-2xl text-ink">管理员搜索</h1>
        <p class="mt-1 text-sm text-muted">支持角色、状态和关键词检索，直接点搜索就是刷新列表。</p>
      </div>
      <div class="chip">Admin</div>
    </div>

    <form
      id="admin-search-form"
      class="mt-4 grid gap-4 md:grid-cols-5"
      hx-get="/admin/users/table"
      hx-target="#admin-table"
      hx-swap="outerHTML"
      hx-indicator="#global-indicator"
      x-on:submit="page = 1"
    >
      <input type="hidden" name="page" x-model="page" />
      <div class="md:col-span-2">
        <label class="label">关键词</label>
        <input
          name="search_q"
          x-model="search_q"
          class="input"
          placeholder="输入账号/姓名/邮箱"
        />
      </div>
      <div>
        <label class="label">角色</label>
        <select name="search_role" x-model="search_role" class="input">
          <option value="">全部</option>
          {% for role in roles %}
            <option value="{{ role.slug }}">{{ role.name }}（{{ role.slug }}）</option>
          {% endfor %}
        </select>
      </div>
      <div>
        <label class="label">状态</label>
        <select name="search_status" x-model="search_status" class="input">
          <option value="">全部</option>
          {% for key, meta in status_meta.items() %}
            <option value="{{ key }}">{{ meta.label }}</option>
          {% endfor %}
        </select>
      </div>
      <div>
        <label class="label">排序</label>
        <select name="search_sort" x-model="search_sort" class="input">
          {% for key, label in admin_sort_options.items() %}
            <option value="{{ key }}">{{ label }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="md:col-span-5 flex flex-wrap justify-end gap-3">
        <button
          type="button"
          class="btn-ghost"
          x-on:click="search_q=''; search_role=''; search_status=''; search_sort='updated_desc'; page=1; $nextTick(() => $el.form.requestSubmit())"
        >
          重置
        </button>
        <button type="submit" class="btn-primary">搜索</button>
      </div>
    </form>
  </section>

  <section>
    {% include "partials/admin_users_table.html" %}
  </section>
</div>
{% endblock %}
